<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html zhtongwen="traditional"><head id="Head"><title>發一個C#程序：bt種子生成器 - sailing - 博客園</title>

<meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta id="metaKeywords" name="keywords" content="发一个C#程序：bt种子生成器"><meta name="C#,.net,C++" content="C#,.net,C++,学习,经验交流"><link id="MainCss" type="text/css" rel="stylesheet" href="951960_files/style.css"><link id="RSSLink" title="RSS" type="application/rss+xml" rel="alternate" href="http://www.cnblogs.com/ThomasNet/rss.aspx"><style>
td { font-size: 12px }
.commentTextBox 
{ 
    font-family : Verdana; 
    font-size: 13px;
 }
</style><style>.userData { BEHAVIOR: url(#default#userdata) }
	</style><style>
a.hot:visited,
a.hot:active,
a.hot:link,
a.hot:hover
{
	color:blue;
	font-size:12px;	
}
</style></head><body>
    <form name="Form1" method="post" action="951960.html" onsubmit="javascript:return WebForm_OnSubmit();" id="Form1">
<div>
<input name="__EVENTTARGET" id="__EVENTTARGET" value="" type="hidden">
<input name="__EVENTARGUMENT" id="__EVENTARGUMENT" value="" type="hidden">
<input name="__VIEWSTATE" id="__VIEWSTATE" value="" type="hidden">
</div>

<script type="text/javascript">
//<![CDATA[
var theForm = document.forms['Form1'];
if (!theForm) {
    theForm = document.Form1;
}
function __doPostBack(eventTarget, eventArgument) {
    if (!theForm.onsubmit || (theForm.onsubmit() != false)) {
        theForm.__EVENTTARGET.value = eventTarget;
        theForm.__EVENTARGUMENT.value = eventArgument;
        theForm.submit();
    }
}
//]]>
</script>


<script src="951960_files/WebResource.js" type="text/javascript"></script>

<script language="JavaScript">
									function ctlent(evt,id)
											{
												if(evt.ctrlKey && evt.keyCode == 13)
												{	
													try
													{
														TempSave(id);
													}
													catch(ex)
													{
													}
													finally
													{
													    __doPostBack('AjaxHolder$PostComment$btnSubmit','')
													}
												}
		
												}</script>
												<script language="JavaScript">function SetReplyAuhor(author){document.getElementById('AjaxHolder_PostComment_tbComment').value+="@"+author+"\n";document.getElementById('AjaxHolder_PostComment_tbComment').focus();return false}</script>
<script src="951960_files/WebResource_002.js" type="text/javascript"></script>
<script src="951960_files/ScriptResource_002.js" type="text/javascript"></script>
<script src="951960_files/ScriptResource.js" type="text/javascript"></script>
<script src="951960_files/js.js" type="text/javascript"></script>
<script type="text/javascript">
//<![CDATA[
function WebForm_OnSubmit() {
if (typeof(ValidatorOnSubmit) == "function" && ValidatorOnSubmit() == false) return false;
return true;
}
//]]>
</script>

        
<!--done-->
<table align="center" border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
	<td background="951960_files/banner1.gif" width="184"></td>
	<td background="951960_files/banner.gif">
<!--done-->
<div class="header">
	<div class="headerText">
		<a id="Header1_HeaderTitle" class="headermaintitle" href="http://www.cnblogs.com/ThomasNet/">sailing</a><br>
		<span style="font-size: 12px; color: rgb(67, 113, 166); padding-left: 20px;">Everything...
<script src="951960_files/urchin.js" type="text/javascript">
</script>
<script type="text/javascript">
_uacct = "UA-2524979-1";
urchinTracker();
</script></span>
	</div>
</div>
</td>
	<td background="951960_files/banner2.gif" width="295"></td>
</tr>
</tbody></table>
<div id="mylinks">
<!--done-->
&nbsp;&nbsp;&nbsp;<a id="MyLinks1_MyHomeLink" class="mainmenu" href="http://thomasnet.cnblogs.com/">首頁</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="MyLinks1_NewArticleLink" class="mainmenu" href="http://www.cnblogs.com/EnterMyBlog.aspx?NewArticle=1">新文章</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="MyLinks1_Syndication" class="mainmenu" href="http://www.cnblogs.com/ThomasNet/rss">訂閱</a><a id="MyLinks1_XMLLink" href="http://www.cnblogs.com/ThomasNet/rss"><img src="951960_files/xml.gif" alt="订阅" style="border-width: 0px;"></a>&nbsp;&nbsp;&nbsp;<a id="MyLinks1_Admin" class="menu" href="http://www.cnblogs.com/ThomasNet/admin/EditPosts.aspx">管理</a>
</div>
<div id="mytopmenu">
	
		<div id="mystats">
			
<!--done-->
<div class="blogStats">
posts - 95,comments - 48,trackbacks - 0

</div></div>
	
</div>
<div id="leftcontent" style="display: inline;">
	
		<div id="leftcontentcontainer">
			<br>
			
			
<!--done-->

		<h1 class="catListTitle">隨筆檔案<span style="font-size: 11px; font-weight: normal;">(95)</span></h1>
		
				<ul class="catList">
			
				<li class="catListItem"> <a id="SingleColumn1_Categories_CatList_ctl00_LinkList_ctl01_Link" class="listitem" href="http://www.cnblogs.com/ThomasNet/archive/2007/11.html">2007年11月 (4)</a></li>
			
				<li class="catListItem"> <a id="SingleColumn1_Categories_CatList_ctl00_LinkList_ctl02_Link" class="listitem" href="http://www.cnblogs.com/ThomasNet/archive/2007/10.html">2007年10月 (5)</a></li>
			
				<li class="catListItem"> <a id="SingleColumn1_Categories_CatList_ctl00_LinkList_ctl03_Link" class="listitem" href="http://www.cnblogs.com/ThomasNet/archive/2007/09.html">2007年9月 (11)</a></li>
			
				<li class="catListItem"> <a id="SingleColumn1_Categories_CatList_ctl00_LinkList_ctl04_Link" class="listitem" href="http://www.cnblogs.com/ThomasNet/archive/2007/08.html">2007年8月 (5)</a></li>
			
				<li class="catListItem"> <a id="SingleColumn1_Categories_CatList_ctl00_LinkList_ctl05_Link" class="listitem" href="http://www.cnblogs.com/ThomasNet/archive/2007/07.html">2007年7月 (8)</a></li>
			
				<li class="catListItem"> <a id="SingleColumn1_Categories_CatList_ctl00_LinkList_ctl06_Link" class="listitem" href="http://www.cnblogs.com/ThomasNet/archive/2007/06.html">2007年6月 (1)</a></li>
			
				<li class="catListItem"> <a id="SingleColumn1_Categories_CatList_ctl00_LinkList_ctl07_Link" class="listitem" href="http://www.cnblogs.com/ThomasNet/archive/2007/04.html">2007年4月 (9)</a></li>
			
				<li class="catListItem"> <a id="SingleColumn1_Categories_CatList_ctl00_LinkList_ctl08_Link" class="listitem" href="http://www.cnblogs.com/ThomasNet/archive/2007/03.html">2007年3月 (15)</a></li>
			
				<li class="catListItem"> <a id="SingleColumn1_Categories_CatList_ctl00_LinkList_ctl09_Link" class="listitem" href="http://www.cnblogs.com/ThomasNet/archive/2007/02.html">2007年2月 (12)</a></li>
			
				<li class="catListItem"> <a id="SingleColumn1_Categories_CatList_ctl00_LinkList_ctl10_Link" class="listitem" href="http://www.cnblogs.com/ThomasNet/archive/2007/01.html">2007年1月 (9)</a></li>
			
				<li class="catListItem"> <a id="SingleColumn1_Categories_CatList_ctl00_LinkList_ctl11_Link" class="listitem" href="http://www.cnblogs.com/ThomasNet/archive/2006/12.html">2006年12月 (3)</a></li>
			
				<li class="catListItem"> <a id="SingleColumn1_Categories_CatList_ctl00_LinkList_ctl12_Link" class="listitem" href="http://www.cnblogs.com/ThomasNet/archive/2006/11.html">2006年11月 (1)</a></li>
			
				<li class="catListItem"> <a id="SingleColumn1_Categories_CatList_ctl00_LinkList_ctl13_Link" class="listitem" href="http://www.cnblogs.com/ThomasNet/archive/2006/07.html">2006年7月 (5)</a></li>
			
				<li class="catListItem"> <a id="SingleColumn1_Categories_CatList_ctl00_LinkList_ctl14_Link" class="listitem" href="http://www.cnblogs.com/ThomasNet/archive/2006/05.html">2006年5月 (3)</a></li>
			
				<li class="catListItem"> <a id="SingleColumn1_Categories_CatList_ctl00_LinkList_ctl15_Link" class="listitem" href="http://www.cnblogs.com/ThomasNet/archive/2006/04.html">2006年4月 (4)</a></li>
			
				</ul>
			
	
		<h1 class="catListTitle">Asp</h1>
		
				<ul class="catList">
			
				<li class="catListItem"> <a id="SingleColumn1_Categories_CatList_ctl01_LinkList_ctl01_Link" class="listitem" href="http://www.asp.net/" target="_blank">asp.net</a></li>
			
				<li class="catListItem"> <a id="SingleColumn1_Categories_CatList_ctl01_LinkList_ctl02_Link" class="listitem" href="http://www.microsoft.com/china/msdn/library/webservices/asp.net/regexnet.mspx?mfr=true" target="_blank">ASP.NET 中的正則表達式</a></li>
			
				<li class="catListItem"> <a id="SingleColumn1_Categories_CatList_ctl01_LinkList_ctl03_Link" class="listitem" href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/script56/html/ab0766e1-7037-45ed-aa23-706f58358c0e.asp" target="_blank">Regular Expression Syntax (Scripting)</a></li>
			
				</ul>
			
	
		<h1 class="catListTitle">Friends</h1>
		
				<ul class="catList">
			
				<li class="catListItem"> <a id="SingleColumn1_Categories_CatList_ctl02_LinkList_ctl01_Link" class="listitem" href="http://dflying.cnblogs.com/" target="_blank">Dflying</a></li>
			
				<li class="catListItem"> <a id="SingleColumn1_Categories_CatList_ctl02_LinkList_ctl02_Link" class="listitem" href="http://kevinwan.cnblogs.com/" target="_blank">Kevin</a></li>
			
				</ul>
			
	
		<h1 class="catListTitle">其它鏈接</h1>
		
				<ul class="catList">
			
				</ul>
			
	


<h3>最新評論
	<a id="SingleColumn1_ctl00_RSSHyperlink1" href="http://www.cnblogs.com/ThomasNet/CommentsRSS.aspx"><img src="951960_files/xml.gif" style="border-width: 0px;"></a></h3>
<div class="RecentComment" id="RecentComments">
	
			<ul>
		
			<li style="">
				<a id="SingleColumn1_ctl00_CommentList_ctl01_Hyperlink1" href="http://www.cnblogs.com/ThomasNet/archive/2007/11/07/951960.html#952158">1.&nbsp;re: 發一個C#程序：bt種子生成器</a>
			</li>
			<li style="">
				關注中.....
			</li>
			<li style="text-align: right; margin-right: 4px;">
				--oxsoft.cn</li>
		
			<li style="">
				<a id="SingleColumn1_ctl00_CommentList_ctl02_Hyperlink1" href="http://www.cnblogs.com/ThomasNet/archive/2007/11/07/951960.html#952047">2.&nbsp;re: 發一個C#程序：bt種子生成器</a>
			</li>
			<li style="">
				torrent文件我覺得完全可以做成xml文件的方式，而不是reinvent the wheel，發明一個bencode。不過可能當初作者考慮到了xml不能很好的保存二進制內容，於是決定自己做一個了。...
			</li>
			<li style="text-align: right; margin-right: 4px;">
				--踏雪無痕</li>
		
			<li style="">
				<a id="SingleColumn1_ctl00_CommentList_ctl03_Hyperlink1" href="http://www.cnblogs.com/ThomasNet/archive/2007/11/07/941991.html#951721">3.&nbsp;re: [原創]C#省電絕招-程序控制顯示器的關閉和恢復</a>
			</li>
			<li style="">
				感覺回到了5年前vb6時代.
			</li>
			<li style="text-align: right; margin-right: 4px;">
				--a11s.net</li>
		
			<li style="">
				<a id="SingleColumn1_ctl00_CommentList_ctl04_Hyperlink1" href="http://www.cnblogs.com/ThomasNet/archive/2007/11/04/948567.html#949111">4.&nbsp;re: 把位圖轉換成矢量圖的VectorMagic</a>
			</li>
			<li style="">
				如果知道怎麼做，要快做，而且效果和性能要好。否則就被其它模仿的人做出來了。
			</li>
			<li style="text-align: right; margin-right: 4px;">
				--踏雪無痕</li>
		
			<li style="">
				<a id="SingleColumn1_ctl00_CommentList_ctl05_Hyperlink1" href="http://www.cnblogs.com/ThomasNet/archive/2007/11/04/948567.html#949055">5.&nbsp;re: 把位圖轉換成矢量圖的VectorMagic</a>
			</li>
			<li style="">
				hmmm 貌似可以這麼做，先把圖片風格化預處理一下，大面積柔化，然後銳化邊緣，分離色階，類似卡通風格的那種，然後提取region，再邊緣提取算法，用拉氏算子或跟蹤都可以，再對region進行平滑內插，...
			</li>
			<li style="text-align: right; margin-right: 4px;">
				--neoragex2002</li>
		
			</ul>
		
</div>

<h3>閱讀排行榜</h3>
<div class="RecentComment" id="TopViewPosts"> 
	
			<ul style="">
		
			<li>
				<a id="SingleColumn1__1095770_TopList_ctl01_Hyperlink1" href="http://www.cnblogs.com/ThomasNet/archive/2007/10/29/941991.html">1.&nbsp;[原創]C#省電絕招-程序控制顯示器的關閉和恢復(1853)</a>
			</li>
		
			<li>
				<a id="SingleColumn1__1095770_TopList_ctl02_Hyperlink1" href="http://www.cnblogs.com/ThomasNet/archive/2007/09/03/879331.html">2.&nbsp;使用HttpWebRequest發送自定義POST請求(1675)</a>
			</li>
		
			<li>
				<a id="SingleColumn1__1095770_TopList_ctl03_Hyperlink1" href="http://www.cnblogs.com/ThomasNet/archive/2006/11/26/573104.html">3.&nbsp;Asp.net cache 簡述(855)</a>
			</li>
		
			<li>
				<a id="SingleColumn1__1095770_TopList_ctl04_Hyperlink1" href="http://www.cnblogs.com/ThomasNet/archive/2006/12/17/595101.html">4.&nbsp;鼠標移動的加速算法（MOUSEEVENTF_MOVE）(669)</a>
			</li>
		
			<li>
				<a id="SingleColumn1__1095770_TopList_ctl05_Hyperlink1" href="http://www.cnblogs.com/ThomasNet/archive/2007/11/07/951960.html">5.&nbsp;發一個C#程序：bt種子生成器(524)</a>
			</li>
		
			</ul>
		
</div>

<h3>60天內閱讀排行</h3>
<div class="RecentComment">
	
			<ul>
		
			<li>
				<a id="SingleColumn1__980904_TopList_ctl01_Hyperlink1" href="http://www.cnblogs.com/ThomasNet/archive/2007/10/29/941991.html">1.&nbsp;[原創]C#省電絕招-程序控制顯示器的關閉和恢復(1853)</a>
			</li>
		
			<li>
				<a id="SingleColumn1__980904_TopList_ctl02_Hyperlink1" href="http://www.cnblogs.com/ThomasNet/archive/2007/11/07/951960.html">2.&nbsp;發一個C#程序：bt種子生成器(524)</a>
			</li>
		
			<li>
				<a id="SingleColumn1__980904_TopList_ctl03_Hyperlink1" href="http://www.cnblogs.com/ThomasNet/archive/2007/09/13/891623.html">3.&nbsp;免費網絡資源-免費虛擬主機(154)</a>
			</li>
		
			<li>
				<a id="SingleColumn1__980904_TopList_ctl04_Hyperlink1" href="http://www.cnblogs.com/ThomasNet/archive/2007/09/25/904774.html">4.&nbsp;幾個重要的web開發參考資料(153)</a>
			</li>
		
			<li>
				<a id="SingleColumn1__980904_TopList_ctl05_Hyperlink1" href="http://www.cnblogs.com/ThomasNet/archive/2007/09/13/891609.html">5.&nbsp;在上海地區租房的網絡資源(116)</a>
			</li>
		
			</ul>
		
</div></div>
	
</div>
<div id="centercontent">
	
					<script type="text/javascript">
//<![CDATA[
Sys.WebForms.PageRequestManager._initialize('AjaxHolder$scriptmanager1', document.getElementById('Form1'));
Sys.WebForms.PageRequestManager.getInstance()._updateControls(['tAjaxHolder$UpdatePanel1'], [], [], 90);
//]]>
</script>

<!--done-->
<div class="post">
	<div class="postTitle">
		<a id="AjaxHolder_ctl01_TitleUrl" class="postTitle2" href="http://www.cnblogs.com/ThomasNet/archive/2007/11/07/951960.html">發一個C#程序：bt種子生成器</a>
	</div>
	<strong>原創文章，未賦予轉載複製的權利。如需轉載，請聯繫博主</strong><br>
<script type="text/javascript"><!--
google_ad_client = "pub-7996156956833820";
//728x90, 07-11-6
google_ad_slot = "2208320299";
google_ad_width = 728;
google_ad_height = 90;
//--></script>
<script type="text/javascript" src="951960_files/show_ads.js">
</script><iframe style="display: none;" name="google_ads_frame" src="951960_files/ads.htm" marginwidth="0" marginheight="0" vspace="0" hspace="0" allowtransparency="true" frameborder="0" height="90" scrolling="no" width="728"></iframe>
<br>
簡要說明：<br>
bt種子torrent文件就是對文件二進制值的<a href="http://www.faqs.org/rfcs/rfc3174.html">sha1</a>
hash，然後按照bencode的格式進行保存。<br>
bencode包含以下的幾個類：<br>
<img src="951960_files/ClassDiagram.png" alt="">
<br>
<br>
IBenCode的定義如下：<br>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-align: left;" align="left">
<span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"><span>&nbsp; &nbsp; </span><span style="color: blue;">
interface</span> IBenCode<o:p></o:p></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-align: left;" align="left">
<span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"><span>&nbsp; &nbsp; </span>{<o:p></o:p></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-align: left;" align="left">
<span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"><span>&nbsp; &nbsp; &nbsp; &nbsp; </span>
<span style="color: blue;">byte</span>[] ToByteArray();<o:p></o:p></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt;">
<span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"><span>&nbsp; &nbsp; </span>}</span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt;">
<br>

</p><div style="margin: 10px 10px 10px 0px; float: left;">
<script type="text/javascript"><!--
google_ad_client = "pub-7996156956833820";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_ad_type = "text_image";
google_ad_channel = "";
google_color_border = "F6F6F6";
google_color_bg = "FFFFFF";
google_color_link = "0000FF";
google_color_text = "000000";
google_color_url = "008000";
google_ui_features = "rc:6";
//-->
</script>
<script type="text/javascript" src="951960_files/show_ads.js">
</script><iframe style="display: none;" name="google_ads_frame" src="951960_files/ads_002.htm" marginwidth="0" marginheight="0" vspace="0" hspace="0" allowtransparency="true" frameborder="0" height="600" scrolling="no" width="120"></iframe>
</div>

規定了所有bencode類型都要提供的功能，用來把內存中的bencode dom轉換成字節序列寫入文件。<br>
另外，bencode中有些string是可顯示的，有compare的需求，有些是用來存儲二進制的，比如hash值。所以我做了兩個類來實現目標：<br>
BenBinaryFormString, BenStringFormString。其中兩個類都需要實現IBenCode接口的ToByteArray方法，為避免代碼重複，我把共同的內容提取到了抽象類中：<br>
<p></p>
<span style="font-size: 9pt; font-family: 新宋体;" lang="EN-US">
<span>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-align: left;" align="left">
<span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"><span>&nbsp; &nbsp; </span><span style="color: blue;">
abstract</span> <span style="color: blue;">class</span> BenByteString : IBenCode<o:p></o:p></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-align: left;" align="left">
<span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"><span>&nbsp; &nbsp; </span>{<o:p></o:p></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-align: left;" align="left">
<span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"><span>&nbsp; &nbsp; &nbsp; &nbsp; </span>
<span style="color: blue;">abstract</span> <span style="color: blue;">protected</span>
<span style="color: blue;">byte</span>[] GetByteArray();<o:p></o:p></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-align: left;" align="left">
<span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"><span>&nbsp; &nbsp; &nbsp; &nbsp; </span>
<span style="color: blue;">public</span> <span style="color: blue;">byte</span>[]
ToByteArray()<o:p></o:p></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-align: left;" align="left">
<span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"><span>&nbsp; &nbsp; &nbsp; &nbsp; </span>
{<o:p></o:p></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-align: left;" align="left">
<span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; </span><span style="color: teal;">List</span>&lt;<span style="color: blue;">byte</span>&gt;
byteList = <span style="color: blue;">new</span> <span style="color: teal;">List</span>&lt;<span style="color: blue;">byte</span>&gt;();<o:p></o:p></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-align: left;" align="left">
<span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; </span><span style="color: blue;">byte</span>[] byteContent = GetByteArray();<o:p></o:p></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-align: left;" align="left">
<span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; </span><span style="color: blue;">string</span> sizeHeader = <span style="color: blue;">
string</span>.Format(<span style="color: maroon;">"{0}:"</span>, byteContent.Length);<o:p></o:p></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-align: left;" align="left">
<span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; </span>byteList.AddRange(<span style="color: teal;">Encoding</span>.UTF8.GetBytes(sizeHeader));<o:p></o:p></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-align: left;" align="left">
<span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; </span>byteList.AddRange(byteContent);<o:p></o:p></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-align: left;" align="left">
<span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; </span><span style="color: blue;">return</span> byteList.ToArray();<o:p></o:p></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-align: left;" align="left">
<span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"><span>&nbsp; &nbsp; &nbsp; &nbsp; </span>
}<o:p></o:p></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt;">
<span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"><span>&nbsp; &nbsp; </span>}</span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-align: left;" align="left">
</p>
</span></span>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt;">
<span style="font-size: 9pt; font-family: 新宋体;" lang="EN-US">
</span>
</p>
<br>
<span style="font-family: Times New Roman;">torrent</span>文件生成過程是：<br>
1. 構建bencode dom<br>
2. 按照一個固定大小比如1M讀取二進制塊<br>
3. 計算出sha1 hash<br>
4. 把bencode dom寫入文件<br>
下面的CreateTorrentFile實現了這個流程：（包括了兩大步驟，DOM的生成和文件寫入）
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-align: left;" align="left">
<span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"><span> </span>
</span>&nbsp;</p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-align: left;" align="left">
<span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"><span>&nbsp; </span><span style="color: blue;">
private</span> <span style="color: blue;">static</span> <span style="color: blue;">void</span>
CreateTorrentFile(<span style="color: blue;">string</span>[] fileName,
<o:p></o:p></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-align: left;" align="left">
<span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; </span><span style="color: blue;">string</span> announceUrl, <span style="color: blue;">
string</span> torrentFileName,
<o:p></o:p>
</span>
</p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-align: left;" align="left">
<span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; </span><span style="color: blue;">string</span> torrentDirectoryName)<o:p></o:p></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-align: left;" align="left">
<span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"><span>&nbsp; &nbsp; &nbsp; &nbsp; </span>
{<o:p></o:p></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-align: left;" align="left">
<span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; </span><span style="color: blue;">string</span>[] sortedFileName = Utility.OrdinalSortStringArray(fileName);<o:p></o:p></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-align: left;" align="left">
<span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; </span><span style="color: green;">// 1. create the torrent tree<o:p></o:p></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-align: left;" align="left">
<span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; </span>BenCode.BenDictionary root = <span style="color: blue;">new</span>
BenCode.BenDictionary();<o:p></o:p></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-align: left;" align="left">
<span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; </span><span style="color: green;">// 1.1 announce URL<o:p></o:p></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-align: left;" align="left">
<span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; </span>root.Add(<span style="color: maroon;">"announce"</span>,<span style="color: blue;">new</span>
BenCode.BenStringFormString(announceUrl));<o:p></o:p></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-align: left;" align="left">
<span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; </span><span style="color: green;">// 1.2 info block<o:p></o:p></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-align: left;" align="left">
<span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; </span>BenCode.BenDictionary info = <span style="color: blue;">new</span>
BenCode.BenDictionary();<o:p></o:p></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-align: left;" align="left">
<span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; </span><span style="color: green;">// 1.2.1 name<o:p></o:p></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-align: left;" align="left">
<span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; </span><span style="color: blue;">bool</span> IsDirectory = !<span style="color: blue;">string</span>.IsNullOrEmpty(torrentDirectoryName);<o:p></o:p></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-align: left;" align="left">
<span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
</span><span>&nbsp; </span><span style="color: blue;">string</span>
strNameValue;<o:p></o:p></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-align: left;" align="left">
<span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; </span><span style="color: blue;">if</span> (IsDirectory)<o:p></o:p></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-align: left;" align="left">
<span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; </span>{<o:p></o:p></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-align: left;" align="left">
<span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; </span>strNameValue = torrentDirectoryName;<o:p></o:p></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-align: left;" align="left">
<span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; </span>}<o:p></o:p></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-align: left;" align="left">
<span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; </span><span style="color: blue;">else<o:p></o:p></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-align: left;" align="left">
<span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; </span>{<o:p></o:p></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-align: left;" align="left">
<span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; </span>strNameValue = <span style="color: teal;">Path</span>.GetFileName(sortedFileName[0]);<o:p></o:p></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-align: left;" align="left">
<span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; </span>}<o:p></o:p></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-align: left;" align="left">
<span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
</span><span>&nbsp; </span>BenCode.BenStringFormString
nameValue =
<o:p></o:p>
</span>
</p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-align: left;" align="left">
<span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; </span><span style="color: blue;">new</span> BenCode.BenStringFormString(strNameValue);<o:p></o:p></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-align: left;" align="left">
<span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; </span>info.Add(<span style="color: maroon;">"name"</span>, nameValue);<o:p></o:p></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-align: left;" align="left">
<span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; </span><span style="color: green;">// 1.2.2 piece length<o:p></o:p></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-align: left;" align="left">
<span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; </span>BenCode.BenInt pieceLength = <span style="color: blue;">new</span>
BenCode.BenInt(1024 * 1024);<o:p></o:p></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-align: left;" align="left">
<span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"><span>&nbsp;</span><span>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span>info.Add(<span style="color: maroon;">"piece
length"</span>, pieceLength);<o:p></o:p></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-align: left;" align="left">
<span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; </span><span style="color: green;">// 1.2.3 pieces<o:p></o:p></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-align: left;" align="left">
<span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; </span>BenCode.BenBinaryFormString pieces =<o:p></o:p></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-align: left;" align="left">
<span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; </span><span style="color: blue;">new</span> BenCode.BenBinaryFormString(Get1MBasedHashFromFiles(sortedFileName));<o:p></o:p></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-align: left;" align="left">
<span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; </span>info.Add(<span style="color: maroon;">"pieces"</span>, pieces);<o:p></o:p></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-align: left;" align="left">
<span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; </span><span style="color: green;">// 1.2.4 single file<o:p></o:p></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-align: left;" align="left">
<span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; </span><span style="color: blue;">if</span> (IsDirectory)<o:p></o:p></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-align: left;" align="left">
<span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; </span>{<o:p></o:p></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-align: left;" align="left">
<span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; </span>BenCode.BenList files = GetFilesBlock(sortedFileName);<o:p></o:p></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-align: left;" align="left">
<span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; </span>info.Add(<span style="color: maroon;">"files"</span>,
files);<o:p></o:p></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-align: left;" align="left">
<span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; </span>}<o:p></o:p></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-align: left;" align="left">
<span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; </span><span style="color: blue;">else<o:p></o:p></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-align: left;" align="left">
<span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; </span>{<o:p></o:p></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-align: left;" align="left">
<span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; </span>BenCode.BenInt length =<o:p></o:p></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-align: left;" align="left">
<span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: blue;">new</span>
BenCode.BenInt(<o:p></o:p></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-align: left;" align="left">
<span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span>Utility.GetFileLength(sortedFileName[0])<o:p></o:p></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-align: left;" align="left">
<span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span>);<o:p></o:p></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-align: left;" align="left">
<span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; </span>info.Add(<span style="color: maroon;">"length"</span>,
length);<o:p></o:p></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-align: left;" align="left">
<span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; </span>}<o:p></o:p></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-align: left;" align="left">
<span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; </span>root.Add(<span style="color: maroon;">"info"</span>, info);<o:p></o:p></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-align: left;" align="left">
<span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; </span><span style="color: green;">// 2. write to the file<o:p></o:p></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-align: left;" align="left">
<span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; </span><span style="color: blue;">using</span> (<span style="color: teal;">FileStream</span>
torrentFileStream = <span style="color: blue;">new</span> <span style="color: teal;">FileStream</span>(torrentFileName,<o:p></o:p></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-align: left;" align="left">
<span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; </span><span style="color: teal;">FileMode</span>.Create,
<span style="color: teal;">FileAccess</span>.Write))<o:p></o:p></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-align: left;" align="left">
<span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; </span>{<o:p></o:p></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-align: left;" align="left">
<span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; </span><span style="color: blue;">byte</span>[] torrentFileByte
= root.ToByteArray();<o:p></o:p></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-align: left;" align="left">
<span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; </span>torrentFileStream.Write(torrentFileByte,<o:p></o:p></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-align: left;" align="left">
<span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span>0, torrentFileByte.Length);<o:p></o:p></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-align: left;" align="left">
<span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; </span>}<o:p></o:p></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt;">
<span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"><span>&nbsp; &nbsp; &nbsp; &nbsp; </span>
}</span></p>
源程序下載地址：<a href="http://www.cnblogs.com/Files/ThomasNet/BtCreator.zip">下載</a>，歡迎提供bug和優化建議<br>
<script type="text/javascript"><!--
google_ad_client = "pub-7996156956833820";
//728x90, 07-11-6
google_ad_slot = "2208320299";
google_ad_width = 728;
google_ad_height = 90;
//--></script>
<script type="text/javascript" src="951960_files/show_ads.js">
</script><iframe style="display: none;" name="google_ads_frame" src="951960_files/ads_003.htm" marginwidth="0" marginheight="0" vspace="0" hspace="0" allowtransparency="true" frameborder="0" height="90" scrolling="no" width="728"></iframe>
<br>
<br>


	<div class="postDesc">posted on 2007-11-07 11:47 <a href="http://thomasnet.cnblogs.com/">踏雪無痕</a> 閱讀(524) <a href="#Post">評論(2)</a> &nbsp;<a href="http://www.cnblogs.com/ThomasNet/admin/EditPosts.aspx?postid=951960">編輯</a> &nbsp;<a id="lnkFavorite951960" href="#" onclick="Favorite(951960,'发一个C#程序：bt种子生成器','http://www.cnblogs.com/ThomasNet/archive/2007/11/07/951960.html',this);return false">收藏</a>  </div>
</div>
<img src="951960_files/951960.jpg" height="1" width="1">

<!--
<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
xmlns:dc="http://purl.org/dc/elements/1.1/"
xmlns:trackback="http://madskills.com/public/xml/rss/module/trackback/">
<rdf:Description
rdf:about="http://www.cnblogs.com/ThomasNet/archive/2007/11/07/951960.html"
dc:identifier="http://www.cnblogs.com/ThomasNet/archive/2007/11/07/951960.html"
dc:title="发一个C#程序：bt种子生成器"
trackback:ping="http://www.cnblogs.com/ThomasNet/services/trackbacks/951960.aspx" />
</rdf:RDF>
-->


<div id="AjaxHolder_UpdatePanel1">
	    
    <a name="pagedcomment"></a>
<!--done-->
<br>
<b>FeedBack:</b>
<div class="feedbackNoItems"></div>
	

		<div class="feedbackItem">
			<div class="feedbackListTitle"><a title="permalink: re: 發一個C#程序：bt種子生成器" href="http://www.cnblogs.com/ThomasNet/archive/2007/11/07/951960.html#952047">#1樓</a>&nbsp;<a name="952047"></a>[樓主]</div>
			<div class="feedbackListSubtitle">
				2007-11-07 13:03 | <a id="AjaxHolder_Comments_CommentList_ctl00_NameLink" href="http://thomasnet.cnblogs.com/" target="_blank">踏雪無痕</a><br>
				<div align="left">torrent
文件我覺得完全可以做成xml文件的方式，而不是reinvent the
wheel，發明一個bencode。不過可能當初作者考慮到了xml不能很好的保存二進制內容，於是決定自己做一個了。不過從這裡，也可以看出xml的
一個弱點：不能保存二進制的值。當然，你可以說base64
encode後再保存到xml裡面。遺憾的是二進制轉成base64的時候體積膨脹了不少。當想解決一個問題的時候就間接導致了另外一個問題，掉進了一個
不斷循環的怪圈。（是不是有點像道教的那兩條黑白魚？）<br>現在想想xml的純文本結構化存儲，漏掉了對二進制值的支持。<br>當面對這麼一盤子要求的時候：結構化存儲，純文本文件，支持二進制值，還真找不到一個完美的辦法。<br>&nbsp;&nbsp;<a onclick='return SetReplyAuhor("踏雪无痕")' href="http://www.cnblogs.com/ThomasNet/archive/2007/11/07/951960.html#post">回覆</a>&nbsp;&nbsp;<a onclick="GetQuote(952047);return false" href="http://www.cnblogs.com/ThomasNet/archive/2007/11/07/951960.html#post">引用</a>&nbsp;&nbsp;<a title="查看該作者發表過的評論" href="http://www.cnblogs.com/CommentsByAuthor.aspx?author=%e8%b8%8f%e9%9b%aa%e6%97%a0%e7%97%95" target="_blank">查看</a>&nbsp;&nbsp;<a id="AjaxHolder_Comments_CommentList_ctl00_DeleteLink" href="javascript:__doPostBack('AjaxHolder$Comments$CommentList$ctl00$DeleteLink','')"></a>&nbsp;&nbsp;<a id="AjaxHolder_Comments_CommentList_ctl00_EditLink"></a></div>
			</div>
			
			
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListTitle"><a title="permalink: re: 發一個C#程序：bt種子生成器" href="http://www.cnblogs.com/ThomasNet/archive/2007/11/07/951960.html#952158">#2樓</a>&nbsp;<a name="952158"></a><a name="Post"></a></div>
			<div class="feedbackListSubtitle">
				2007-11-07 14:42 | <a id="AjaxHolder_Comments_CommentList_ctl01_NameLink" href="http://oxsoft.cn/" target="_blank">oxsoft.cn [未註冊用戶]</a><br>
				<div align="left">關注中.....<br>&nbsp;&nbsp;<a onclick='return SetReplyAuhor("oxsoft.cn")' href="http://www.cnblogs.com/ThomasNet/archive/2007/11/07/951960.html#post">回覆</a>&nbsp;&nbsp;<a onclick="GetQuote(952158);return false" href="http://www.cnblogs.com/ThomasNet/archive/2007/11/07/951960.html#post">引用</a>&nbsp;&nbsp;<a title="查看該作者發表過的評論" href="http://www.cnblogs.com/CommentsByAuthor.aspx?author=oxsoft.cn+%5b%e6%9c%aa%e6%b3%a8%e5%86%8c%e7%94%a8%e6%88%b7%5d" target="_blank">查看</a>&nbsp;&nbsp;<a id="AjaxHolder_Comments_CommentList_ctl01_DeleteLink" href="javascript:__doPostBack('AjaxHolder$Comments$CommentList$ctl01$DeleteLink','')"></a>&nbsp;&nbsp;<a id="AjaxHolder_Comments_CommentList_ctl01_EditLink"></a></div>
			</div>
			
			
		</div>
	





<!--Beging Temp Save-->

<div class="userData" id="CommentsPersistDiv"></div>

<script type="text/javascript">
function pageLoad()
{
    Sys.WebForms.PageRequestManager.getInstance().add_initializeRequest(handleInitializeRequest);
    //Sys.WebForms.PageRequestManager.getInstance().add_endRequest(handleEndRequest);
}

function handleInitializeRequest(sender, args)
{
    var prm = Sys.WebForms.PageRequestManager.getInstance();
    var eid = args.get_postBackElement().id;
    if (eid.indexOf("DeleteLink")>0) 
    {
       args.get_postBackElement().innerHTML = "<font color='red'>正在刪除...</font>";         
    }    
    else if (eid.indexOf("btnSubmit")>0) 
    {
       document.getElementById("AjaxHolder_PostComment_ltSubmitMsg").innerHTML="正在提交...";
       document.getElementById("AjaxHolder_PostComment_btnSubmit").disabled = true;       
    }   
    else if(eid.indexOf("refreshList")>0)
    {
        document.getElementById("AjaxHolder_PostComment_refreshList").innerHTML="<font color='red'>正在刷新...</font>";
    }
   
}	

function TempSave(ElementID)
{
	try
	{
	CommentsPersistDiv.setAttribute("CommentContent",document.getElementById(ElementID).value);
	CommentsPersistDiv.save("CommentXMLStore");
	}
	catch(ex)
	{
	}
	
}
function Restore(ElementID)
{
	CommentsPersistDiv.load("CommentXMLStore");
	document.getElementById(ElementID).value=CommentsPersistDiv.getAttribute("CommentContent");
}	
			
			
</script>
<!--Ene TempSave-->
<div id="divRefreshComments" style="text-align: right; margin-right: 10px; margin-bottom: 5px; font-size: 12px;"><a id="AjaxHolder_PostComment_refreshList" href="javascript:__doPostBack('AjaxHolder$PostComment$refreshList','')">刷新評論列表</a>&nbsp;&nbsp;</div>
<div class="commentform">
<span id="AjaxHolder_PostComment_ltSubmitMsg" style="color: Red;"></span>
<br>
<a name="Feedback"></a>
	<table border="0" cellpadding="1" cellspacing="1">
		<tbody><tr>
			<td width="75"></td>
			<td></td>
			<td></td>
		</tr>
		<tr>
			<td width="55">標題</td>
			<td><input name="AjaxHolder$PostComment$tbTitle" value="re: 发一个C#程序：bt种子生成器" id="AjaxHolder_PostComment_tbTitle" class="commenttb" style="width: 320px;" type="text"></td>
			<td><span id="AjaxHolder_PostComment_RequiredFieldValidator1" style="color: Red; visibility: hidden;">請輸入標題</span></td>
		</tr>
		<tr>
			<td>姓名</td>
			<td><input name="AjaxHolder$PostComment$tbName" id="AjaxHolder_PostComment_tbName" class="commenttb" style="width: 320px;" type="text"></td>
			<td><span id="AjaxHolder_PostComment_RequiredFieldValidator2" style="color: Red; visibility: hidden;">請輸入你的姓名</span></td>
		</tr>
		<tr>
			<td>主頁</td>
			<td><input name="AjaxHolder$PostComment$tbUrl" id="AjaxHolder_PostComment_tbUrl" class="commenttb" style="width: 320px;" type="text"></td>
			<td><font face="宋体"></font></td>
		</tr>
		<tr id="AjaxHolder_PostComment_trEmail">
		<td>Email</td>
		<td><input name="AjaxHolder$PostComment$tbEmail" id="AjaxHolder_PostComment_tbEmail" class="commenttb" style="width: 200px;" type="text">(只有博主才能看到)<span id="AjaxHolder_PostComment_revContactMail" style="color: Red; visibility: hidden;">郵件地址無效</span></td>
		<td></td>
	</tr>
	
		<tr>
			<td colspan="3" align="left">
				<table id="AjaxHolder_PostComment_tbCaptchaImage" class="CommentForm" border="0" cellpadding="0" cellspacing="0">
		<tbody><tr>
			<td colspan="3">
							<span id="AjaxHolder_PostComment_Requiredfieldvalidator4" style="color: Red; display: none;">請輸入驗證碼</span>
							<span id="AjaxHolder_PostComment_lblImage" style="color: Red; font-weight: bold;"></span>
						</td>
		</tr>
		<tr>
			<td width="78">驗證碼</td>
			<td><input name="AjaxHolder$PostComment$CodeNumberTextBox" id="AjaxHolder_PostComment_CodeNumberTextBox" type="text">*&nbsp;&nbsp;<img src="951960_files/JpegImage.jpg"></td>
			<td align="left"></td>
		</tr>
	</tbody></table>
	
			</td>
		</tr>
		<tr>
			<td colspan="3">內容(請不要發表任何與政治相關的內容)
				<span id="AjaxHolder_PostComment_RequiredFieldValidator3" style="color: Red; visibility: hidden;">請輸入評論內容</span><br>
				<textarea name="AjaxHolder$PostComment$tbComment" rows="10" cols="50" id="AjaxHolder_PostComment_tbComment" class="commentTextBox" onkeydown="ctlent(event,'AjaxHolder_PostComment_tbComment')" style="width: 480px; height: 220px;"></textarea></td>
		</tr>
		<tr>
			<td colspan="3">
		<span id="AjaxHolder_PostComment_Message" style="color: Red;"></span>
		</td>
		</tr><tr>
			<td colspan="3"><input id="AjaxHolder_PostComment_chkRemember" name="AjaxHolder$PostComment$chkRemember" checked="checked" tabindex="-1" type="checkbox"><label for="AjaxHolder_PostComment_chkRemember">Remember Me?</label></td>
		</tr>
		<tr>
			<td height="23"><input name="AjaxHolder$PostComment$btnSubmit" value="提交" onclick="TempSave('AjaxHolder_PostComment_tbComment');WebForm_DoPostBackWithOptions(new WebForm_PostBackOptions(&quot;AjaxHolder$PostComment$btnSubmit&quot;, &quot;&quot;, true, &quot;&quot;, &quot;&quot;, false, false))" id="AjaxHolder_PostComment_btnSubmit" class="commentButton" type="submit">
				</td>
			<td colspan="2" height="23">&nbsp;
				<a id="AjaxHolder_PostComment_lnkLogin" href="http://www.cnblogs.com/login.aspx?ReturnURL=http://www.cnblogs.com/ThomasNet/archive/2007/11/07/951960.html&amp;SourceURL=/ThomasNet/archive/2007/11/07/951960.html">登錄</a>&nbsp;&nbsp;<a id="AjaxHolder_PostComment_linkLoginComment" onclick="if(document.getElementById('AjaxHolder_PostComment_tbComment').value != '') return confirm('未提交的评论内容将会丢失, 你真的要进入高级评论吗?');" href="http://www.cnblogs.com/ThomasNet/archive/2007/11/07/951960.html?login=1#Post">使用高級評論</a>&nbsp;&nbsp;<a href="http://www.cnblogs.com/RequireRegister.aspx">新用戶註冊</a>&nbsp;&nbsp;<a href="#Top">返回頁首</a>&nbsp;&nbsp;<a id="AjaxHolder_PostComment_lbRestore" onclick="Restore('AjaxHolder_PostComment_tbComment'); return false;" href="http://www.cnblogs.com/ThomasNet/archive/2007/11/07/951960.html#Post">恢復上次提交</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</td>
		</tr>
		<tr>
			<td colspan="3"><label class="CtrlEnter">[使用Ctrl+Enter鍵可以直接提交]</label></td>
		</tr>
		<tr>
			<td colspan="3">該文被作者在 2007-11-07 12:30 編輯過</td>
		</tr>
		<tr>
			<td colspan="3" height="5">&nbsp;</td>
		</tr>
		<tr>
			<td colspan="3" height="5"></td>
		</tr>
		<tr>
			<td colspan="3" height="5">&nbsp;</td>
		</tr>
		<tr>
			<td colspan="3" height="5"></td>
		</tr>
		<tr>
			<td colspan="3"><a href="http://bbs.zdnet.com.cn/" target="_blank" class="blue">IT人的互動社區—ZDNetChina中文社區</a>
				
<br>

<br>
<script type="text/javascript"><!--
google_ad_client = "pub-4210569241504288";
google_ad_width = 468;
google_ad_height = 60;
google_ad_format = "468x60_as";
google_ad_type = "text";
google_ad_channel ="";
google_color_link = "6699CC";
//--></script>
<script type="text/javascript" src="951960_files/show_ads.js">
</script><iframe style="display: none;" name="google_ads_frame" src="951960_files/ads_004.htm" marginwidth="0" marginheight="0" vspace="0" hspace="0" allowtransparency="true" frameborder="0" height="60" scrolling="no" width="468"></iframe>
<br>
<br>
</td>
		</tr>	
		<tr>
			<td colspan="3">
				
服務器託管服務商：<a href="http://www.18606.com/" target="_blank">零刻數據</a>。
<br>
<br>
<iframe marginheight="0" marginwidth="0" src="951960_files/ad.htm" style="border: 0px solid rgb(102, 102, 102);" allowtransparency="true" frameborder="0" height="80" scrolling="no" width="468"></iframe>
<br></td>
		</tr>		
	</tbody></table>	
</div>
<div id="AjaxHolder_PostComment_ValidationSummary1" style="color: Red; display: none;">

	</div>

</div>
<script language="javascript">

function GetQuote(id)
{
    //www.cnblogs.com.ICommentService.GetCommentText(id,SetQuote);
    BlogServer.WebService.AjaxWS.GetComment(id,SetQuote);
}

 function SetQuote(result)
{
    document.getElementById('AjaxHolder_PostComment_tbComment').value += ("--引用--------------------------------------------------\n"+result+"\n--------------------------------------------------------\n");
    document.getElementById('AjaxHolder_PostComment_tbComment').focus(); 
}

function Favorite(entryID,title,url,element)
{
    document.getElementById(element.id).innerHTML = "<span style='color:red'>正在收藏...</span>";
    BlogServer.WebService.AjaxWS.AddToFavorites(entryID,title,url,OnFavoriteSuccess);
    document.getElementById(element.id).removeAttribute("href");
    document.getElementById(element.id).removeAttribute("onclick");
}

function OnFavoriteSuccess(result)
{
    if(result == "請先登錄")
    {
        window.location.href = "../../../../../login.aspx?ReturnUrl=" + window.location.href;
    }
    else
    {
        var returnstr = result.split(",");
        var id = "lnkFavorite"+returnstr[0];
        document.getElementById(id).innerHTML = "<span style='color:red'>" + returnstr[1] + "</span>";
    }
}
</script>

				
</div>

<!--done-->
<div class="footer">
	
	Copyright ©2007 踏雪無痕 Powered By<a href="http://www.cnblogs.com/">博客園</a> 模板提供：<a href="http://blog.hjenglish.com/">滬江博客</a>
</div>
    
<script type="text/javascript">
//<![CDATA[
var Page_ValidationSummaries =  new Array(document.getElementById("AjaxHolder_PostComment_ValidationSummary1"));
var Page_Validators =  new Array(document.getElementById("AjaxHolder_PostComment_RequiredFieldValidator1"), document.getElementById("AjaxHolder_PostComment_RequiredFieldValidator2"), document.getElementById("AjaxHolder_PostComment_revContactMail"), document.getElementById("AjaxHolder_PostComment_Requiredfieldvalidator4"), document.getElementById("AjaxHolder_PostComment_RequiredFieldValidator3"));
//]]>
</script>

<script type="text/javascript">
//<![CDATA[
var AjaxHolder_PostComment_RequiredFieldValidator1 = document.all ? document.all["AjaxHolder_PostComment_RequiredFieldValidator1"] : document.getElementById("AjaxHolder_PostComment_RequiredFieldValidator1");
AjaxHolder_PostComment_RequiredFieldValidator1.controltovalidate = "AjaxHolder_PostComment_tbTitle";
AjaxHolder_PostComment_RequiredFieldValidator1.errormessage = "請輸入標題";
AjaxHolder_PostComment_RequiredFieldValidator1.evaluationfunction = "RequiredFieldValidatorEvaluateIsValid";
AjaxHolder_PostComment_RequiredFieldValidator1.initialvalue = "";
var AjaxHolder_PostComment_RequiredFieldValidator2 = document.all ? document.all["AjaxHolder_PostComment_RequiredFieldValidator2"] : document.getElementById("AjaxHolder_PostComment_RequiredFieldValidator2");
AjaxHolder_PostComment_RequiredFieldValidator2.controltovalidate = "AjaxHolder_PostComment_tbName";
AjaxHolder_PostComment_RequiredFieldValidator2.errormessage = "請輸入你的姓名";
AjaxHolder_PostComment_RequiredFieldValidator2.evaluationfunction = "RequiredFieldValidatorEvaluateIsValid";
AjaxHolder_PostComment_RequiredFieldValidator2.initialvalue = "";
var AjaxHolder_PostComment_revContactMail = document.all ? document.all["AjaxHolder_PostComment_revContactMail"] : document.getElementById("AjaxHolder_PostComment_revContactMail");
AjaxHolder_PostComment_revContactMail.controltovalidate = "AjaxHolder_PostComment_tbEmail";
AjaxHolder_PostComment_revContactMail.errormessage = "郵件地址無效";
AjaxHolder_PostComment_revContactMail.evaluationfunction = "RegularExpressionValidatorEvaluateIsValid";
AjaxHolder_PostComment_revContactMail.validationexpression = "^([0-9a-zA-Z+-._]([+-._\\w]*[0-9a-zA-Z+-._])*@([0-9a-zA-Z][-\\w]*\\.)+[a-zA-Z]{2,9})$";
var AjaxHolder_PostComment_Requiredfieldvalidator4 = document.all ? document.all["AjaxHolder_PostComment_Requiredfieldvalidator4"] : document.getElementById("AjaxHolder_PostComment_Requiredfieldvalidator4");
AjaxHolder_PostComment_Requiredfieldvalidator4.controltovalidate = "AjaxHolder_PostComment_CodeNumberTextBox";
AjaxHolder_PostComment_Requiredfieldvalidator4.errormessage = "請輸入驗證碼";
AjaxHolder_PostComment_Requiredfieldvalidator4.display = "Dynamic";
AjaxHolder_PostComment_Requiredfieldvalidator4.evaluationfunction = "RequiredFieldValidatorEvaluateIsValid";
AjaxHolder_PostComment_Requiredfieldvalidator4.initialvalue = "";
var AjaxHolder_PostComment_RequiredFieldValidator3 = document.all ? document.all["AjaxHolder_PostComment_RequiredFieldValidator3"] : document.getElementById("AjaxHolder_PostComment_RequiredFieldValidator3");
AjaxHolder_PostComment_RequiredFieldValidator3.controltovalidate = "AjaxHolder_PostComment_tbComment";
AjaxHolder_PostComment_RequiredFieldValidator3.errormessage = "請輸入評論內容";
AjaxHolder_PostComment_RequiredFieldValidator3.evaluationfunction = "RequiredFieldValidatorEvaluateIsValid";
AjaxHolder_PostComment_RequiredFieldValidator3.initialvalue = "";
var AjaxHolder_PostComment_ValidationSummary1 = document.all ? document.all["AjaxHolder_PostComment_ValidationSummary1"] : document.getElementById("AjaxHolder_PostComment_ValidationSummary1");
AjaxHolder_PostComment_ValidationSummary1.showmessagebox = "True";
AjaxHolder_PostComment_ValidationSummary1.showsummary = "False";
//]]>
</script>


<script type="text/javascript">
<!--
var Page_ValidationActive = false;
if (typeof(ValidatorOnLoad) == "function") {
    ValidatorOnLoad();
}

function ValidatorOnSubmit() {
    if (Page_ValidationActive) {
        return ValidatorCommonOnSubmit();
    }
    else {
        return true;
    }
}
// -->
</script>
        
<script type="text/javascript">
//<![CDATA[
Sys.Application.initialize();
//]]>
</script>
</form>
    <script type="text/javascript" src="951960_files/ShowHidden.js"></script>      
</body></html>